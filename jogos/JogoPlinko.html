<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Plinko Demo — Casa de Apostas (somente fictícia)</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#11172a; --soft:#17223d; --accent:#7c3aed; --text:#e5e7eb; --muted:#94a3b8; --good:#22c55e; --bad:#ef4444; --warn:#f59e0b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 600px at 70% -10%,#1b2550 0%,#0b1020 55%);color:var(--text);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Ubuntu}
    .wrap{max-width:1200px;margin:24px auto;padding:16px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#22d3ee)}
    h1{font-size:22px;margin:0}
    .badge{font-size:12px;color:var(--muted)}

    .grid{display:grid;grid-template-columns:380px 1fr;gap:16px}
    .card{background:linear-gradient(180deg,var(--panel),#0f1428);border:1px solid #1b2545;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .card .hd{padding:14px 16px;border-bottom:1px solid #1b2545;display:flex;align-items:center;justify-content:space-between}
    .card .bd{padding:16px}

    .controls{display:grid;gap:10px}
    label{font-size:12px;color:var(--muted)}
    input[type="number"],select{width:100%;padding:10px;border-radius:12px;background:#0d1326;border:1px solid #1b2545;color:var(--text)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .buttons{display:flex;gap:10px}
    button{flex:1;padding:12px 14px;border-radius:14px;border:1px solid #28325a;background:linear-gradient(180deg,#1a2450,#131c3c);color:#fff;font-weight:600;cursor:pointer}
    button.primary{background:linear-gradient(180deg,var(--accent),#4c1d95);border:none}
    button:disabled{opacity:.6;cursor:not-allowed}

    .balance{display:flex;align-items:center;justify-content:space-between;background:#0e1530;border:1px solid #1b2545;border-radius:12px;padding:10px 12px}
    .balance strong{font-size:18px}

    .notice{font-size:12px;color:var(--muted);line-height:1.5;margin-top:10px}

    canvas{display:block;width:100%;height:640px;background:linear-gradient(180deg,#0c132c,#0a1126);border-bottom-left-radius:16px;border-bottom-right-radius:16px}

    .legend{display:grid;grid-template-columns:repeat(6,1fr);gap:8px}
    .chip{border:1px solid #26335f;background:#0c1430;border-radius:12px;padding:8px 10px;text-align:center;font-size:13px}
    .chip .x{display:block;color:var(--muted);font-size:11px}
    .chip.win{border-color:#205f3b}
    .chip.lose{border-color:#5f2020}

    .bets{display:flex;gap:10px;flex-wrap:wrap}
    .betval{padding:6px 10px;border-radius:999px;border:1px solid #27305a;background:#0c1430;cursor:pointer}

    footer{margin-top:16px;font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>OrbBet • Plinko</h1>
          <div class="badge">DEMO educacional — dinheiro fictício, não use para apostas reais.</div>
        </div>
      </div>
      <div class="balance">
        <span>Saldo</span>
        <strong id="balance">R$ 1.000,00</strong>
      </div>
    </header>

    <div class="grid">
      <!-- Painel esquerdo: controles -->
      <section class="card">
        <div class="hd"><strong>Configurar Aposta</strong><span id="status" class="badge">pronto</span></div>
        <div class="bd">
          <div class="controls">
            <div class="row">
              <div>
                <label>Valor da aposta (R$)</label>
                <input id="bet" type="number" min="1" step="1" value="10" />
              </div>
              <div>
                <label>Bolas</label>
                <input id="balls" type="number" min="1" max="50" step="1" value="1" />
              </div>
            </div>
            <div class="row">
              <div>
                <label>Linhas</label>
                <select id="rows">
                  <option value="8">8</option>
                  <option value="10" selected>10</option>
                  <option value="12">12</option>
                  <option value="14">14</option>
                </select>
              </div>
              <div>
                <label>Risco</label>
                <select id="risk">
                  <option value="low">Baixo</option>
                  <option value="medium" selected>Médio</option>
                  <option value="high">Alto</option>
                </select>
              </div>
            </div>

            <div>
              <label>Atalhos de aposta</label>
              <div class="bets">
                <button type="button" class="betval" data-v="5">R$5</button>
                <button type="button" class="betval" data-v="10">R$10</button>
                <button type="button" class="betval" data-v="25">R$25</button>
                <button type="button" class="betval" data-v="50">R$50</button>
                <button type="button" class="betval" data-v="100">R$100</button>
              </div>
            </div>

            <div class="buttons">
              <button id="play" class="primary">Jogar</button>
              <button id="auto">Auto</button>
            </div>

            <p class="notice">Este é um simulador client‑side sem dinheiro real. As probabilidades são ajustáveis por “Risco” e as animações podem variar ligeiramente o resultado. Jogue com responsabilidade.</p>

            <div class="legend" id="payouts"></div>
          </div>
        </div>
      </section>

      <!-- Painel direito: jogo -->
      <section class="card">
        <div class="hd"><strong>Plinko</strong><span class="badge">HTML5 Canvas</span></div>
        <canvas id="game" width="760" height="640" aria-label="tabuleiro do jogo"></canvas>
      </section>
    </div>

    <footer>
      © 2025 OrbBet — Demo educativa. Se apostar virou problema, procure ajuda especializada. Limite seu tempo e orçamento.
    </footer>
  </div>

  <script>
    // ======= Utilidades =======
    const fmtBRL = v => v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    const clamp = (x,a,b)=>Math.max(a,Math.min(b,x));

    // RNG com seed simples para repetibilidade opcional
    let seed = Date.now() % 2147483647;
    function srand(){ seed = (seed * 48271) % 2147483647; return seed/2147483647; }

    // ======= Estado =======
    const state = {
      balance: 1000,
      bet: 10,
      balls: 1,
      rows: 10,
      risk: 'medium',
      running: false,
      auto: false,
      activeBalls: [],
      pegs: [],
      slots: [],
      multipliers: [],
    };

    // ======= Elementos =======
    const $balance = document.getElementById('balance');
    const $bet = document.getElementById('bet');
    const $balls = document.getElementById('balls');
    const $rows = document.getElementById('rows');
    const $risk = document.getElementById('risk');
    const $play = document.getElementById('play');
    const $auto = document.getElementById('auto');
    const $payouts = document.getElementById('payouts');
    const $status = document.getElementById('status');

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    function updateUI(){
      $balance.textContent = fmtBRL(state.balance);
      $bet.value = state.bet;
      $balls.value = state.balls;
      $rows.value = String(state.rows);
      $risk.value = state.risk;
      renderLegend();
    }

    // ======= Multiplicadores por risco =======
    function generateMultipliers(rows, risk){
      const n = rows + 1; // número de slots
      // base simétrica; extremos pagam mais, centro paga menos
      let base = [];
      for(let i=0;i<n;i++){
        let t = Math.abs(i - (n-1)/2) / ((n-1)/2); // 0 no centro, 1 nos extremos
        base.push(t);
      }
      // Curva por risco
      let curve;
      if(risk==='low') curve = base.map(t=>1 + 0.2 + Math.pow(t,1.5)*2.0); // 1.2x a ~3.2x
      else if(risk==='medium') curve = base.map(t=>0.8 + Math.pow(t,1.8)*4.0); // 0.8x a ~4.8x
      else curve = base.map(t=>0.4 + Math.pow(t,2.1)*9.0); // 0.4x a ~9.4x

      // Pequenos ajustes e arredondamento para 2 casas
      return curve.map(x=>Math.max(0.2, Math.round(x*100)/100));
    }

    function renderLegend(){
      $payouts.innerHTML = '';
      state.multipliers.forEach((m,i)=>{
        const d = document.createElement('div');
        d.className = 'chip ' + (m>=1?'win':'lose');
        d.innerHTML = `<span class="x">Slot ${i+1}</span><strong>${m.toFixed(2)}x</strong>`;
        $payouts.appendChild(d);
      });
    }

    // ======= Construção do tabuleiro =======
    const board = { x: 40, y: 60, w: canvas.width-80, h: canvas.height-120 };
    const gravity = 0.18;
    const pegR = 5;
    const ballR = 7;

    function buildBoard(){
      state.pegs = [];
      const rows = state.rows;
      const cols = rows; // aproximado
      const spacingX = board.w / cols;
      const spacingY = (board.h - 120) / rows;
      for(let r=0;r<rows;r++){
        for(let c=0;c<=r;c++){
          const offsetX = (board.w - r*spacingX)/2;
          const x = board.x + offsetX + c*spacingX;
          const y = board.y + r*spacingY;
          state.pegs.push({x,y});
        }
      }
      // slots
      state.slots = [];
      const nSlots = rows+1;
      for(let i=0;i<nSlots;i++){
        const x = board.x + (board.w/nSlots)*(i+0.5);
        const y = board.y + rows*spacingY + 40;
        state.slots.push({x,y,w:board.w/nSlots});
      }
      state.multipliers = generateMultipliers(rows, state.risk);
      renderLegend();
    }

    // ======= Físicas simples =======
    function spawnBall(){
      // Start acima do topo, posição aleatória no topo do triângulo
      const x = board.x + board.w/2 + (srand()-0.5)*40;
      const y = board.y - 10;
      state.activeBalls.push({x,y,vx: (srand()-0.5)*1.2, vy:0, done:false});
    }

    function stepBall(b){
      b.vy += gravity;
      b.x += b.vx; b.y += b.vy;
      // paredes laterais do tabuleiro
      if(b.x < board.x+ballR){ b.x=board.x+ballR; b.vx*=-0.6; }
      if(b.x > board.x+board.w-ballR){ b.x=board.x+board.w-ballR; b.vx*=-0.6; }

      // colisão com pinos (simplificada)
      for(const p of state.pegs){
        const dx = b.x - p.x, dy = b.y - p.y;
        const dist = Math.hypot(dx,dy);
        const minDist = pegR + ballR;
        if(dist < minDist){
          const nx = dx / (dist||1), ny = dy / (dist||1);
          // afasta
          const overlap = (minDist - dist);
          b.x += nx * overlap;
          b.y += ny * overlap;
          // reflete com aleatoriedade leve
          const dot = b.vx*nx + b.vy*ny;
          b.vx = (b.vx - 2*dot*nx) * 0.85 + (srand()-0.5)*0.1;
          b.vy = (b.vy - 2*dot*ny) * 0.85 + (srand()-0.5)*0.1;
        }
      }

      // chão / slots
      const floorY = board.y + (state.rows)*((board.h - 120)/state.rows) + 50;
      if(b.y > floorY){
        // determinar slot
        const idx = clamp(Math.floor((b.x - board.x) / (board.w/(state.rows+1))),0,state.rows);
        b.done = true; b.slot = idx;
      }
    }

    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      // fundo bordas
      ctx.save();
      ctx.strokeStyle = '#1b2545';
      ctx.lineWidth = 2;
      ctx.strokeRect(board.x, board.y-20, board.w, board.h);
      ctx.restore();

      // pinos
      ctx.fillStyle = '#24335f';
      for(const p of state.pegs){
        ctx.beginPath();
        ctx.arc(p.x,p.y,pegR,0,Math.PI*2);
        ctx.fill();
      }

      // slots e multiplicadores
      const nSlots = state.rows+1;
      const slotW = board.w/nSlots;
      for(let i=0;i<nSlots;i++){
        const x = board.x + i*slotW;
        const y = board.y + (state.rows)*((board.h - 120)/state.rows) + 50;
        ctx.fillStyle = (state.multipliers[i]>=1)?'#123f26':'#3f1212';
        ctx.fillRect(x,y,slotW,26);
        ctx.fillStyle = '#cbd5e1';
        ctx.font = '12px system-ui';
        ctx.textAlign='center';
        ctx.fillText(`${state.multipliers[i].toFixed(2)}x`, x+slotW/2, y+18);
      }

      // bolas
      ctx.fillStyle = '#7c3aed';
      for(const b of state.activeBalls){
        ctx.beginPath();
        ctx.arc(b.x,b.y,ballR,0,Math.PI*2);
        ctx.fill();
      }
    }

    function loop(){
      for(const b of state.activeBalls){ if(!b.done) stepBall(b); }
      draw();

      // coleta concluídas
      const done = state.activeBalls.filter(b=>b.done);
      if(done.length){
        for(const b of done){
          const m = state.multipliers[b.slot];
          const win = +(state.bet * m).toFixed(2);
          const diff = +(win - state.bet).toFixed(2);
          state.balance = +(state.balance + diff).toFixed(2);
          toast(diff>=0?`Ganhou ${fmtBRL(win)} (${m.toFixed(2)}x)`: `Perdeu ${fmtBRL(Math.abs(diff))}`);
        }
        state.activeBalls = state.activeBalls.filter(b=>!b.done);
        updateUI();
        if(state.auto && !state.running) scheduleAuto();
      }

      requestAnimationFrame(loop);
    }

    // ======= Fluxo de jogo =======
    function canPlay(){ return state.bet>0 && state.bet<=state.balance; }

    function playOnce(){
      if(!canPlay()) { toast('Saldo insuficiente', true); return; }
      state.running = true; $status.textContent = 'jogando';
      state.balance = +(state.balance - state.bet).toFixed(2);
      updateUI();
      const n = clamp(Math.floor(state.balls),1,50);
      for(let i=0;i<n;i++) setTimeout(spawnBall, i*220);
      // finalizar rodada quando última bola cair
      setTimeout(()=>{ state.running=false; $status.textContent='pronto'; }, n*220+1600);
    }

    function scheduleAuto(){
      if(!state.auto) return;
      if(!canPlay()) { state.auto=false; $auto.classList.remove('primary'); toast('Auto parado: saldo insuficiente', true); return; }
      setTimeout(()=>{ playOnce(); if(state.auto) scheduleAuto(); }, 600);
    }

    // ======= Toast simples =======
    let toastTimer; const toasts=[];
    function toast(msg, warn=false){
      clearTimeout(toastTimer);
      const bar = document.createElement('div');
      bar.textContent = msg;
      bar.style.cssText = 'position:fixed;right:16px;bottom:16px;background:'+ (warn?'#7f1d1d':'#0f172a') +';color:#fff;padding:10px 12px;border:1px solid #1b2545;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.3);z-index:50;opacity:.98';
      document.body.appendChild(bar);
      toastTimer = setTimeout(()=>bar.remove(), 1800);
    }

    // ======= Events =======
    $bet.addEventListener('input', e=>{ state.bet = +e.target.value; });
    $balls.addEventListener('input', e=>{ state.balls = +e.target.value; });
    $rows.addEventListener('change', e=>{ state.rows = +e.target.value; buildBoard(); });
    $risk.addEventListener('change', e=>{ state.risk = e.target.value; state.multipliers = generateMultipliers(state.rows, state.risk); renderLegend(); });

    document.querySelectorAll('.betval').forEach(btn=>btn.addEventListener('click',()=>{ state.bet = +btn.dataset.v; $bet.value=state.bet; }));

    $play.addEventListener('click', playOnce);
    $auto.addEventListener('click', ()=>{ state.auto = !state.auto; $auto.classList.toggle('primary', state.auto); if(state.auto && !state.running) scheduleAuto(); });

    // ======= Inicialização =======
    buildBoard();
    updateUI();
    draw();
    loop();
  </script>
</body>
</html>
